<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8" />
    <title>QuillTask - {% block title %}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a10f0f4961.js" crossorigin="anonymous"></script>

    <!-- Tailwind Config -->
    <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'fade-slide': 'fadeSlide 0.6s ease-out both',
            'fade-in': 'fadeIn 0.3s ease-in-out',
          },
          keyframes: {
            fadeSlide: {
              '0%': { opacity: '0', transform: 'translateY(-10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            }
          }
        }
      }
    };
    </script>

    <!-- Apply saved theme -->
    <script>
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark");
      }
    </script>
    <style>
        /* CSS to manage the dropdown's display state and max-width on mobile */
        .dropdown-menu {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease-in-out;
            position: absolute;
            right: 0;
            z-index: 50;
            /* FIX: Set a max-width to prevent overflow on small screens */
            max-width: 14rem;
            /* REMOVED: white-space: nowrap; This was causing the menu to expand beyond the screen */
        }
        .dropdown-menu.show {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        .profile-button {
            cursor: pointer;
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-300">

    <!-- Navbar -->
    <nav class="animate-fade-slide w-full bg-slate-100 dark:bg-gray-800 shadow px-6 py-4 flex justify-between items-center">

        <!-- Logo Left -->
        <div class="flex items-center gap-3">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="QuillTask Logo" class="h-10 w-10 rounded-full shadow-md" />
            <h1 class="text-2xl font-bold text-indigo-700 dark:text-indigo-300">QuillTask</h1>
        </div>

        <!-- Right-side actions -->
        <div class="flex items-center gap-4">
            <button id="theme-toggle"
                class="w-10 h-10 flex items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 text-xl text-gray-800 dark:text-gray-200 shadow hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-300">
                ðŸŒž
            </button>
            
            {% if current_user.is_authenticated %}
            <div class="relative">
                <button id="profile-btn" class="profile-button flex items-center justify-center h-10 w-10 rounded-full bg-indigo-600 text-white font-bold text-lg focus:outline-none focus:ring-2 focus:ring-indigo-400">
                    {{ current_user.name[0] | upper }}
                    <i class="fas fa-chevron-down text-sm ml-1 transition-transform duration-200" id="dropdown-icon"></i>
                </button>
                <div id="dropdown-menu" class="dropdown-menu mt-2 py-2 w-auto right-0 rounded-md shadow-lg bg-white dark:bg-gray-800 border dark:border-gray-700">
                    <div class="px-4 py-2 border-b border-gray-200 dark:border-gray-700">
                        <p class="text-sm text-gray-500 dark:text-gray-400 truncate">{{ current_user.email }}</p>
                    </div>
                    <a href="{{ url_for('logout') }}"
                       class="block px-4 py-2 text-sm text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200">
                        <i class="fas fa-sign-out-alt mr-2"></i> Logout
                    </a>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('login') }}" class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-300 dark:hover:text-indigo-100 font-semibold transition-colors duration-200">
                Login
            </a>
            {% endif %}

        </div>
    </nav>

    <!-- Main Content -->
    {% block content %}{% endblock %}

    <!-- Scripts -->
    <script>
        const toggleBtn = document.getElementById("theme-toggle");

        function setIcon() {
            toggleBtn.textContent = document.documentElement.classList.contains("dark") ? "ðŸŒ™" : "ðŸŒž";
        }

        setIcon();

        toggleBtn.addEventListener("click", () => {
            const html = document.documentElement;
            html.classList.toggle("dark");
            const mode = html.classList.contains("dark") ? "dark" : "light";
            localStorage.setItem("theme", mode);
            setIcon();
        });

        document.addEventListener('DOMContentLoaded', function() {
            const profileBtn = document.getElementById('profile-btn');
            const dropdownMenu = document.getElementById('dropdown-menu');
            const dropdownIcon = document.getElementById('dropdown-icon');

            if (profileBtn && dropdownMenu) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const isVisible = dropdownMenu.classList.contains('show');
                    if (isVisible) {
                        dropdownMenu.classList.remove('show');
                        dropdownIcon.classList.remove('rotate-180');
                    } else {
                        dropdownMenu.classList.add('show');
                        dropdownIcon.classList.add('rotate-180');
                    }
                });

                window.addEventListener('click', function(e) {
                    if (!profileBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
                        dropdownMenu.classList.remove('show');
                        dropdownIcon.classList.remove('rotate-180');
                    }
                });
            }
        });
    </script>
</body>
</html>
